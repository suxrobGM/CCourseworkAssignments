#include "base_functions.h"

#define MATRIX_LENGTH(arr) ((int) (sizeof (arr) / sizeof (arr)[0]))

char* collection_ids[] = {
    "100003355850395", "100025160682118", "100038419710588", "100014222641963", "100023134999333",
    "100028113063444", "100042009543166", "100035056337289", "100009612576986", "100004820046187",
    "100013999750453", "100044073558214", "100007235864199", "100048431776495", "100041135535542",
    "100034943963940", "100030040033109", "100042981180500", "100043701576260", "100047574813632",
    "100034759691043", "100046830666433", "100047037032824", "100039899064113", "100037755465472",
    "100037830759490", "100014728509521", "100048623715229", "100009515447111", "100022154477782",
    "100004101526641", "100047584955954", "100047266038851", "100023449093846", "100036634161653",
    "100041905000352", "100047364906230", "100013813271169", "100041873917749", "100010898557240",
    "100048195817280", "100037218217139", "100031068602705", "100036438140356", "100004003969940",
    "100035891790636", "100033970183121", "100003754819198", "100038107446901", "100022433404930",
    "100003105270476", "100038119591305", "100031130589007", "100040671993752", "100022335061482",
    "100043162553184", "100039402186620", "100041482550642", "100003401177158", "100034037220182",
    "100040907963595", "100047111714186", "100035297610659", "100043436870440", "100027530682877",
    "100026051087476", "100037679723755", "100041896334348", "100037215428176", "100018316353696",
    "100045942562640", "100042739983511", "1262016538",      "100028616678180", "100047071771261",
    "100001481569554", "100035178799884", "100042536523193", "100043410792683", "100038623398589",
    "100035422718710", "100043950156456", "100003350638216", "100037968589515", "100028186305284",
    "100031466959161", "100033117583213", "100034984290643", "100036804642004", "100017100785943",
    "100011476479257", "100037336809071", "100036379505550", "100006622054940", "100022898612362",
    "100029916615332", "100024145352713", "100041397633562", "100016894294351", "100029712499530",
    "100011725283538", "100014373405676", "100009750392044", "100032711919464", "100026706613024",
    "100039324487602", "100023945136036", "100015416087549", "100037655250247", "100035572852212",
    "100026458988107", "100026860710651", "100022261383531", "100036154298643", "100008361514337",
    "100012828902928", "100023428493694", "100006056827879", "100028788526786", "100015767736333",
    "100038973231930", "100006580395296", "100017268648150", "100022574595486", "100025787708528",
    "100023173633911", "100008267027927", "100022197529345", "100038094601952", "100009539411951",
    "100008402835508", "100035154661020", "100030242971019", "100021813465340", "100024075273715",
    "100014515380880", "100023916640017", "100028162129832", "100038844451620", "100022169117186",
    "100039224377637", "100013223557978", "100038186224253", "100040449003652", "100035844314582",
    "100020181606420", "100038939852506", "100029524551046", "100015442770782", "100013850589950",
    "100005954733886", "100014402495771", "100014186731240", "100014111431308", "100009632171678",
    "100026996411747", "100026323282673", "100036573138005", "100009932164636", "100046108604968",
    "100023943455538", "100027741460748", "100012809145644", "100014814525236", "100028286622324",
    "100024508842085", "100021591108911", "100035794110814", "100026263702616", "100002397712989",
    "100027171647246", "100032921837143", "100041859185450", "100024727325812", "100025641759192",
    "100026466014255", "100023539660680", "100034243206240", "100010234802854", "100024420790362",
    "100028273762197", "100038462109163", "100002199762613", "100035312210166", "100022490835874",
    "100026516675880", "100035189921631", "100010847408901", "100025138660004", "100025330209809",
    "100030003220419", "100026455479829", "100007301866051", "100013313949661", "100023392369184",
    "100011407822345", "100024648072816", "100027548694329", "100004355298826", "100011269697587",
    "100021912826194", "100023836963502", "100025758903790", "100003059561131", "100027832727990",
    "100038696464959", "100003254055920", "100022875051740", "100022162487863", "100038946680204",
    "100011696208857", "100014335864877", "100004506139424", "100038009172778", "100025069806552",
    "100035300242282", "100028707871302", "100024294001830", "100009513283560", "100030583101689",
    "100009334131934", "100008797727183", "100035290023960", "100036390150195", "100025570179484",
    "100008316756837", "100003599491722", "100026598722096", "100027647656734", "100021907631342",
    "100029147412236", "100025526207643", "100037057689197", "100031147787763", "100025952290176",
    "100023809546699", "100037161461471", "100026083209382", "100026431213573", "100011161152418",
    "100011046072988", "100038611597037", "100001353481866", "100025441989439", "100002400052310",
    "100036191420744", "100022627484898", "100013529415921", "100038910794292", "100032743037532",
    "100011227594552", "100004368992657", "100035331012243", "100006288733039", "100024824582480",
    "100003324422408", "100025866558316", "100026887901794", "100003710420360", "100016323585230",
    "100038309329609", "100026359583622", "100037581948188", "100025400970372", "100024501365853",
    "100017241222680", "100024332287211", "100039116716210", "100025938263373", "100009623174295",
    "100036995027257", "100024814183483", "100015595592353", "100033662345298", "100035252490561",
    "100021780352793", "100031288262544", "100026035393650", "100028349044639", "100027661942175",
    "100003269195815", "100004764435014", "100034864934313", "100030716177313", "100005788625035",
    "100025462052539", "100035960371115", "100017955048770", "100001732755146", "100030159393111",
    "100008911150299", "100025855581498", "100007834751547", "100006758711617", "100034310027706",
    "100026468898814", "100002647132119", "100016148970540", "100024104991186", "100038019724543",
    "100026570169189", "100026051563954", "100034322981318", "100026168616391", "100037833313544",
    "100001872543933", "100037440771384", "100022912832651", "100017021325110", "100016402322044",
    "100005711419498", "100037945757210", "100029095215418", "100038717328696", "100007745078258",
    "100007288245520", "100025941855861", "22619814",        "100009552196387", "100025342204215",
    "100022045134366", "100026448051210", "100006652908199", "100009276194247", "1114586424",
    "100010805471498", "100037788127964", "100022641015494", "100035134824288", "100009503815939",
    "100025752921893", "100025167549844", "100028184522067", "100030754571973", "100018621432519",
    "100025700205042", "100000802263337", "100007361497162", "100022997317636", "100035209627988",
    "100028207682712", "100037090206758", "100016991256189", "100005190965486", "100024331656679",
    "100025795339216", "100034692579557", "100026107366394", "100024773629969", "100019356843975",
    "100037784394057", "100026372329405", "100000185497605", "100026748582695", "100029298682103",
    "100003972543578", "100036907102748", "100038298401001", "100019406973773", "100026341350973",
    "100026380364017", "100001674268907", "100040367690832", "100038827505673", "100005238137141",
    "100002364444810", "100003933332990", "100022146979980", "100037674217944", "100028613745307",
    "100022959742165", "100035059099224", "100000560434432", "100009018191525", "100013099806659",
    "1598035418",      "100009070983178", "100038983477121", "100009898876376", "100025667041643",
    "100030602419698", "100001124861425", "100009199868084", "100034319864879", "100011136674956",
    "100003259464266", "100001333873059", "100037776941509", "100035867743055", "100028676614252",
    "100042116524338", "100035169770547", "100015026476816", "100038226646665", "100010579868873",
    "100004426959838", "100009612576986", "100003355850395", "100004820046187", "100038419710588",
    "100014222641963", "100013999750453", "100044073558214", "100007235864199", "100023134999333",
    "100048431776495", "100025160682118", "100028113063444", "100041135535542", "100034943963940",
    "100030040033109", "100042981180500", "100043701576260", "100047574813632", "100034759691043",
    "100046830666433", "100047037032824", "100039899064113", "100037755465472", "100037830759490",
    "100042009543166", "100014728509521", "100048623715229", "100009515447111", "100022154477782",
    "100004101526641", "100047584955954", "100047266038851", "100035056337289", "100023449093846",
    "100036634161653", "100041905000352", "100047364906230", "100013813271169", "100041873917749",
    "100010898557240", "100048195817280", "100037218217139", "100031068602705", "100036438140356",
    "100004003969940", "100035891790636", "100033970183121", "100003754819198", "100038107446901",
    "100022433404930", "100003105270476", "100038119591305", "100031130589007", "100040671993752",
    "100022335061482", "100043162553184", "100039402186620", "100041482550642", "100003401177158",
    "100034037220182", "100040907963595", "100047111714186", "100035297610659", "100043436870440",
    "100027530682877", "100026051087476", "100037679723755", "100041896334348", "100037215428176",
    "100018316353696", "100045942562640", "100042739983511", "1262016538",      "100028616678180",
    "100047071771261", "100001481569554", "100035178799884", "100042536523193", "100043410792683",
    "100035422718710", "100038623398589", "100043950156456", "100003350638216", "100037968589515",
    "100028186305284", "100031466959161", "100033117583213", "100034984290643", "100036804642004",
    "100017100785943", "100011476479257", "100037336809071", "100036379505550", "100006622054940",
    "100022898612362", "100029916615332", "100024145352713"
};

char* most_frequent(char* arr[]) 
{ 
    int arr_rows = MATRIX_LENGTH(collection_ids);
  
    // find the max frequency using linear traversal 
    int max_count = 1, curr_count = 1;
    char* res = arr[0]; 
    for (int i = 1; i < arr_rows; i++) 
    { 
        if (strcmp(arr[i], arr[i - 1]) == 0) 
        {
            curr_count++; 
        }    
        else 
        { 
            if (curr_count > max_count) 
            { 
                max_count = curr_count; 
                //strcpy(res, arr[i - 1]);
                res = arr[i - 1];
            } 
            curr_count = 1; 
        } 
    } 
  
    // If last element is most frequent 
    if (curr_count > max_count) 
    { 
        max_count = curr_count;
        //strcpy(res, arr[arr_rows - 1]);
        res = arr[arr_rows - 1]; 
    } 
  
    return res; 
} 

int comparator(const void* a, const void* b)
{
    const char *pa = *(const char**)a;
    const char *pb = *(const char**)b;

    return strcmp(pa, pb);
}

void run_program()
{
    puts("Scanning IDs...");
    int arr_rows = MATRIX_LENGTH(collection_ids);
    qsort(collection_ids, arr_rows, sizeof(char *), comparator);
    FILE* file = fopen("sorted_ids.txt", "w");

    puts("All IDs saved in the \'sorted_ids.txt\' file");
    for (size_t i = 0; i < arr_rows; i++)
    {
        fprintf(file, "\"%s\", \n", collection_ids[i]);
    }

    fclose(file);
    char* most_viewed_id = most_frequent(collection_ids);

    puts("\n-----------------------------------------------------------------------");
    printf("Most viewed ID is %s\n", most_viewed_id);
    puts("-----------------------------------------------------------------------");
}

int main()
{
    display_welcome_message("This program will show facebook profile id which were most viewed your profile");
    char choosed_action[10];

    while (1)
    {
        display_choice_action();
        fflush(stdin);
        scanf("%s", choosed_action);

        if (strcmp(choosed_action, "run") == 0)
        {
            run_program();
        }
        else if (strcmp(choosed_action, "quit") == 0)
        { 
            quit_program();
            break;
        }
        else
        {
            display_error_message("Invalid value, please try again");
        }
    }

    return 0;
}